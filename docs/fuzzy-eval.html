<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>10&nbsp; 模糊综合评价 – mathmodels 包使用手册</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./dea.html" rel="next">
<link href="./rank-sum-ratio.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script><script>
MathJax ={
  tex: {
    macros: {
      bm: ["{\\boldsymbol #1}",1],
    }
  }
};
</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./comp-eval.html">评价类算法</a></li><li class="breadcrumb-item"><a href="./fuzzy-eval.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">模糊综合评价</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="搜索" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">mathmodels 包使用手册</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="搜索"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">前言</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./comp-eval.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">评价类算法</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">指标数据预处理</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ahp-weight.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">层次分析法</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./entropy-weight.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">熵权法</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./critic-weight.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">CRITIC 法</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pca-weight.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">主成分赋权法</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./combine-weights.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">主客观组合赋权</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./topsis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">TOPSIS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./grey-relational.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">灰色关联分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rank-sum-ratio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">秩和比法</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fuzzy-eval.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">模糊综合评价</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dea.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">数据包络分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inequality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">不平等度量</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regional-economics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">区域经济</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./system-eval.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">系统评价</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">参考文献</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">目录</h2>
   
  <ul>
<li>
<a href="#%E6%A8%A1%E7%B3%8A%E7%90%86%E8%AE%BA" id="toc-模糊理论" class="nav-link active" data-scroll-target="#%E6%A8%A1%E7%B3%8A%E7%90%86%E8%AE%BA"><span class="header-section-number">10.1</span> 模糊理论</a>
  <ul class="collapse">
<li><a href="#%E6%A8%A1%E7%B3%8A%E9%9B%86%E4%B8%8E%E9%9A%B6%E5%B1%9E%E5%BA%A6" id="toc-模糊集与隶属度" class="nav-link" data-scroll-target="#%E6%A8%A1%E7%B3%8A%E9%9B%86%E4%B8%8E%E9%9A%B6%E5%B1%9E%E5%BA%A6"><span class="header-section-number">10.1.1</span> 模糊集与隶属度</a></li>
  <li><a href="#%E9%9A%B6%E5%B1%9E%E5%87%BD%E6%95%B0" id="toc-隶属函数" class="nav-link" data-scroll-target="#%E9%9A%B6%E5%B1%9E%E5%87%BD%E6%95%B0"><span class="header-section-number">10.1.2</span> 隶属函数</a></li>
  <li><a href="#compute_mf-%E5%87%BD%E6%95%B0" id="toc-compute_mf-函数" class="nav-link" data-scroll-target="#compute_mf-%E5%87%BD%E6%95%B0"><span class="header-section-number">10.1.3</span> <code>compute_mf()</code> 函数</a></li>
  <li><a href="#%E6%A8%A1%E7%B3%8A%E8%BF%90%E7%AE%97" id="toc-模糊运算" class="nav-link" data-scroll-target="#%E6%A8%A1%E7%B3%8A%E8%BF%90%E7%AE%97"><span class="header-section-number">10.1.4</span> 模糊运算</a></li>
  </ul>
</li>
  <li><a href="#%E6%A8%A1%E7%B3%8A%E7%BB%BC%E5%90%88%E8%AF%84%E4%BB%B7%E7%AE%97%E6%B3%95%E6%AD%A5%E9%AA%A4" id="toc-模糊综合评价算法步骤" class="nav-link" data-scroll-target="#%E6%A8%A1%E7%B3%8A%E7%BB%BC%E5%90%88%E8%AF%84%E4%BB%B7%E7%AE%97%E6%B3%95%E6%AD%A5%E9%AA%A4"><span class="header-section-number">10.2</span> 模糊综合评价算法步骤</a></li>
  <li>
<a href="#%E6%A1%88%E4%BE%8B%E8%80%95%E4%BD%9C%E6%96%B9%E6%A1%88%E7%9A%84%E6%A8%A1%E7%B3%8A%E7%BB%BC%E5%90%88%E8%AF%84%E4%BB%B7" id="toc-案例耕作方案的模糊综合评价" class="nav-link" data-scroll-target="#%E6%A1%88%E4%BE%8B%E8%80%95%E4%BD%9C%E6%96%B9%E6%A1%88%E7%9A%84%E6%A8%A1%E7%B3%8A%E7%BB%BC%E5%90%88%E8%AF%84%E4%BB%B7"><span class="header-section-number">10.3</span> 案例：耕作方案的模糊综合评价</a>
  <ul class="collapse">
<li><a href="#%E5%87%86%E5%A4%87%E8%AF%84%E4%BB%B7%E5%AF%B9%E8%B1%A1%E6%95%B0%E6%8D%AE%E8%A1%A82" id="toc-准备评价对象数据表2" class="nav-link" data-scroll-target="#%E5%87%86%E5%A4%87%E8%AF%84%E4%BB%B7%E5%AF%B9%E8%B1%A1%E6%95%B0%E6%8D%AE%E8%A1%A82"><span class="header-section-number">10.3.1</span> 准备评价对象数据（表2）</a></li>
  <li><a href="#%E5%87%86%E5%A4%87%E9%98%88%E5%80%BC%E6%95%B0%E6%8D%AE%E4%BB%8E%E8%A1%A81%E6%8F%90%E7%82%BC%E7%94%A8%E4%BA%8E%E8%AE%A1%E7%AE%97%E9%9A%B6%E5%B1%9E%E5%90%91%E9%87%8F" id="toc-准备阈值数据从表1提炼用于计算隶属向量" class="nav-link" data-scroll-target="#%E5%87%86%E5%A4%87%E9%98%88%E5%80%BC%E6%95%B0%E6%8D%AE%E4%BB%8E%E8%A1%A81%E6%8F%90%E7%82%BC%E7%94%A8%E4%BA%8E%E8%AE%A1%E7%AE%97%E9%9A%B6%E5%B1%9E%E5%90%91%E9%87%8F"><span class="header-section-number">10.3.2</span> 准备阈值数据（从表1提炼，用于计算隶属向量）</a></li>
  <li><a href="#%E6%89%B9%E9%87%8F%E6%A8%A1%E7%B3%8A%E7%BB%BC%E5%90%88%E8%AF%84%E4%BB%B7" id="toc-批量模糊综合评价" class="nav-link" data-scroll-target="#%E6%89%B9%E9%87%8F%E6%A8%A1%E7%B3%8A%E7%BB%BC%E5%90%88%E8%AF%84%E4%BB%B7"><span class="header-section-number">10.3.3</span> 批量模糊综合评价</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./comp-eval.html">评价类算法</a></li><li class="breadcrumb-item"><a href="./fuzzy-eval.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">模糊综合评价</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-fce" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">模糊综合评价</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p><strong>模糊综合评价法</strong>（Fuzzy Comprehensive Evaluation, FCE） 是一种基于模糊数学理论的综合评价方法，适用于处理具有模糊性和不确定性的多因素评价问题。该方法通过构建隶属函数，将定性指标转化为定量描述，有效刻画“亦此亦彼”的中间过渡状态，从而克服传统评价方法中“非黑即白”的二值判断局限，使评价结果更加贴近现实情况。</p>
<p>加载包：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(mathmodels)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="模糊理论" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="模糊理论">
<span class="header-section-number">10.1</span> 模糊理论</h2>
<section id="模糊集与隶属度" class="level3" data-number="10.1.1"><h3 data-number="10.1.1" class="anchored" data-anchor-id="模糊集与隶属度">
<span class="header-section-number">10.1.1</span> 模糊集与隶属度</h3>
<p>用数学的眼光看世界，现象分为确定性现象、随机现象、模糊现象（如“今天天气有点冷”，“小伙子很高”等）。模糊理论的基本思想是，用属于程度代替属于或不属于，比如某人属于高个子的程度为 <span class="math inline">\(0.8\)</span>）。</p>
<p><strong>经典集合语言：</strong></p>
<p>只有两种情况，要么 <span class="math inline">\(x \in A\)</span>，要么 <span class="math inline">\(x \notin A\)</span>，用特征函数 <span class="math inline">\(\chi (\cdot) : A \to \{ 0, 1\}\)</span> 表示： <span class="math display">\[
\chi(x) = \left\{ \begin{array}{ll} 1, &amp; x \in A \\ 0, &amp; x \notin A \end{array} \right.
\]</span></p>
<p><strong>模糊集合语言：</strong></p>
<p>用隶属度函数 <span class="math inline">\(\mu_A(\cdot): A \to [0,1]\)</span> 表示，它确定了 <span class="math inline">\(X\)</span> 上的一个模糊集 <span class="math inline">\(A\)</span>。<span class="math inline">\(\mu_A(x)\)</span> 越接近 <span class="math inline">\(1\)</span>，表明 <span class="math inline">\(x\)</span> 属于 <span class="math inline">\(A\)</span> 的程度越大。</p>
<p>一般用 <span class="math inline">\(A(x)\)</span> 表示 <span class="math inline">\(x\)</span> 对模糊集 <span class="math inline">\(A\)</span> 的隶属度。</p>
<p><strong>注：</strong>模糊集与隶属函数，是一一对应的，是同一个事物的两种表示。</p>
<p><strong>例 1</strong> 考虑全集：<span class="math inline">\(\text{周几} = \{\text{周一},\text{周二},\cdots,\text{周日}\}\)</span>。</p>
<ol type="1">
<li>在经典集语义下说，子集：<span class="math inline">\(\text{周末} = \{\text{周六}, \, \text{周日}\}\)</span>
</li>
</ol>
<ul>
<li>周几是否属于周末是完全确定的：是或否</li>
<li>从非周末到周末，是突变过去的</li>
</ul>
<ol start="2" type="1">
<li>从实际来说，周末并没有严格的界限，周五、周一甚至周四都有一部分也属于周末。这正好符合模糊集语义：</li>
</ol>
<ul>
<li>周几是否属于周末，可能是完全属于、部分属于、完全不属于，比如 <span class="math inline">\(\text{周五属于周末的程度} = 0.8\)</span>
</li>
<li>从非周末到周末，是连续变化过去的</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figs/weekend.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>严格周末与模糊周末</figcaption></figure>
</div>
</div>
</div>
</section><section id="隶属函数" class="level3" data-number="10.1.2"><h3 data-number="10.1.2" class="anchored" data-anchor-id="隶属函数">
<span class="header-section-number">10.1.2</span> 隶属函数</h3>
<p><strong>隶属函数</strong> <span class="math inline">\(\mu_A(x), x \in X\)</span> 将 <span class="math inline">\(X\)</span> 中每个元映射到 <span class="math inline">\([0,1]\)</span> 上某个隶属度值。</p>
<p>例如，上面右图就是周几隶属于周末的程度的隶属函数曲线，根据该函数可以计算无论周几的任一时刻属于周末的程度是多少。</p>
<p>隶属函数是任意曲线，其形状可以人为定义，只要简单、方便、快速和高效。 准确地确定隶属函数是定量刻化模糊概念的基础，也是利用模糊方法解决各种实际问题的关键。</p>
<p>常用隶属函数确定方法：模糊统计法，主观/专家经验法，二元对比排序法，拟合模糊分布法，最小模糊度法。</p>
<section id="模糊统计法" class="level4" data-number="10.1.2.1"><h4 data-number="10.1.2.1" class="anchored" data-anchor-id="模糊统计法">
<span class="header-section-number">10.1.2.1</span> 模糊统计法</h4>
<p>模糊统计法，是基于评委评语/打分的数据统计，这是 tidyverse 最擅长的。</p>
<section id="从评委打分评语数据到隶属矩阵" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="从评委打分评语数据到隶属矩阵">1. 从评委打分/评语数据到隶属矩阵</h5>
<p>例如，模糊综合评价衣服的评语集为：“差”、“一般”、“好”。评委直接给出若干评价对象（衣服）各指标的评语，当然评委也可以是打分，根据分数阈值离散化到各评语。</p>
<p>这样的数据，不需要隶属函数，做分组统计就能得到隶属向量。</p>
<p>比如，某件衣服，对于色彩，经过统计发现：<span class="math inline">\(80\%\)</span> 的评委认为是 “好”，<span class="math inline">\(10\%\)</span> 的评委认为是”一般”，<span class="math inline">\(10\%\)</span> 的评委认为是”差”。</p>
<p>则该件衣服的色彩隶属于评语集每个评语：“好”、“一般”、“差”的隶属度，即隶属向量为：<span class="math inline">\([0.8, 0.1, 0.1]\)</span></p>
<p>同理，处理其他指标：做工、品牌、款式。</p>
<p>下面随机生成了一个数据作为演示，包含 <span class="math inline">\(10\)</span> 个评委对 <span class="math inline">\(3\)</span> 件衣服上述 <span class="math inline">\(4\)</span> 个指标的打分：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>df <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">30</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">120</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>), <span class="at">ncol =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> <span class="st">"universal"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">"评委"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each =</span> <span class="dv">4</span>), </span>
<span id="cb2-6"><a href="#cb2-6"></a>         指标 <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"颜色"</span>,<span class="st">"做工"</span>,<span class="st">"品牌"</span>,<span class="st">"款式"</span>), <span class="dv">3</span>), <span class="at">.before =</span> <span class="dv">1</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>第一步</strong>，先宽变长变整洁，根据阈值，比如 <span class="math inline">\([60, 75]\)</span> 离散化为评语：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>df <span class="ot">=</span> df <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">names_to =</span> <span class="st">"评委"</span>, <span class="at">values_to =</span> <span class="st">"打分"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">mutate</span>(评语 <span class="ot">=</span> <span class="fu">case_when</span>(打分 <span class="sc">&lt;</span> <span class="dv">60</span> <span class="sc">~</span> <span class="st">"差"</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>                          打分 <span class="sc">&lt;</span> <span class="dv">75</span> <span class="sc">~</span> <span class="st">"一般"</span>,</span>
<span id="cb3-5"><a href="#cb3-5"></a>                          <span class="at">.default =</span> <span class="st">"好"</span>),</span>
<span id="cb3-6"><a href="#cb3-6"></a>         评语 <span class="ot">=</span> <span class="fu">factor</span>(评语, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"差"</span>,<span class="st">"一般"</span>,<span class="st">"好"</span>)))</span>
<span id="cb3-7"><a href="#cb3-7"></a>df</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 120 × 5
      ID 指标  评委    打分 评语 
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;fct&gt;
 1     1 颜色  评委1     97 好   
 2     1 颜色  评委2     66 一般 
 3     1 颜色  评委3     99 好   
 4     1 颜色  评委4     31 差   
 5     1 颜色  评委5     42 差   
 6     1 颜色  评委6     80 好   
 7     1 颜色  评委7     77 好   
 8     1 颜色  评委8     66 一般 
 9     1 颜色  评委9     36 差   
10     1 颜色  评委10    46 差   
# ℹ 110 more rows</code></pre>
</div>
</div>
<p><strong>第二步</strong>，数据统计：分组汇总评语频数，分组计算评语百分比</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>df <span class="ot">=</span> df <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">count</span>(ID, 指标, 评语) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n), <span class="at">.by =</span> <span class="fu">c</span>(ID, 指标))</span>
<span id="cb5-4"><a href="#cb5-4"></a>df</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 35 × 5
      ID 指标  评语      n     p
   &lt;int&gt; &lt;chr&gt; &lt;fct&gt; &lt;int&gt; &lt;dbl&gt;
 1     1 做工  差        2   0.2
 2     1 做工  一般      7   0.7
 3     1 做工  好        1   0.1
 4     1 品牌  差        6   0.6
 5     1 品牌  一般      3   0.3
 6     1 品牌  好        1   0.1
 7     1 款式  差        3   0.3
 8     1 款式  一般      3   0.3
 9     1 款式  好        4   0.4
10     1 颜色  差        4   0.4
# ℹ 25 more rows</code></pre>
</div>
</div>
<p><strong>第三步</strong>，整理结果得到每件衣服的隶属矩阵</p>
<p>第二步已经计算出了所有隶属向量中的元素，只不过是堆在了一列 <code>p</code> 当中。每件衣服的取出来，每个评语的占一列，就是隶属矩阵。需要做的就是：按衣服切分 + 长变宽。</p>
<p>先把一件衣服做长变宽，写成函数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(data) {</span>
<span id="cb7-2"><a href="#cb7-2"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> 评语, <span class="at">names_from =</span> 指标, <span class="at">values_from =</span> p) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="fu">select</span>(<span class="sc">-</span>评语)</span>
<span id="cb7-5"><a href="#cb7-5"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>再按衣服切分数据，批量地做长变宽：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">split</span>(df, df<span class="sc">$</span>ID) <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">map</span>(f)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`1`
# A tibble: 3 × 4
   做工  品牌  款式  颜色
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1   0.2   0.6   0.3   0.4
2   0.7   0.3   0.3   0.2
3   0.1   0.1   0.4   0.4

$`2`
# A tibble: 3 × 4
   做工  品牌  款式  颜色
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1   0.3   0.4   0.3  NA  
2   0.3   0.3   0.4   0.5
3   0.4   0.3   0.3   0.5

$`3`
# A tibble: 3 × 4
   做工  品牌  款式  颜色
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1   0.4   0.5   0.5   0.6
2   0.1   0.1   0.3   0.1
3   0.5   0.4   0.2   0.3</code></pre>
</div>
</div>
</section><section id="从评委区间数据到隶属函数" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="从评委区间数据到隶属函数">2. 从评委区间数据到隶属函数</h5>
<p>这是模糊理论中理解隶属函数的经典示例，根据关于“青年人”年龄区间调查表，确定“青年人”的隶属函数。</p>
<p>该表记录了 129 位专家关于“青年人”年龄区间的调查结果。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>df <span class="ot">=</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/youth.xlsx"</span>, </span>
<span id="cb10-2"><a href="#cb10-2"></a>                        <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">"g"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>))</span>
<span id="cb10-4"><a href="#cb10-4"></a>df</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 13
   g1    g2    g3    g4    g5    g6    g7    g8    g9    g10   g11   g12   g13  
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1 18−25 18−30 17−30 20−35 15−28 18−25 18−35 19−28 17−30 16−30 15−28 15−25 16−28
 2 18−30 18−25 18−28 17−30 15−30 18−30 18−35 15−25 17−25 17−30 18−35 18−25 18−30
 3 16−28 18−30 18−35 15−30 18−35 15−28 15−25 16−32 18−30 18−35 17−30 18−35 16−28
 4 20−30 16−30 18−35 18−35 18−29 17−28 18−35 18−35 18−25 18−30 16−28 17−27 15−26
 5 16−35 18−35 15−25 15−27 18−35 16−30 14−25 18−25 18−30 20−30 18−28 18−30 15−30
 6 18−28 18−25 16−25 20−30 18−35 18−30 18−30 16−28 17−25 16−30 18−30 15−25 18−35
 7 18−30 18−28 18−26 16−35 16−28 16−25 15−35 17−30 15−25 16−35 15−30 18−30 15−25
 8 16−30 16−30 15−28 15−36 15−25 17−28 18−30 16−25 18−30 17−25 18−29 17−29 15−30
 9 17−30 16−30 16−35 15−30 14−25 18−35 16−30 18−30 18−35 16−28 18−25 18−30 18−28
10 18−35 16−24 18−30 17−30 15−30 18−35 18−25 18−30 15−30 15−30 17−30 18−30 &lt;NA&gt; </code></pre>
</div>
</div>
<p><strong>第一步</strong>，数据处理：宽变长（忽略缺失）、分割列（转化数值）</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>df <span class="ot">=</span> df <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"g"</span>, <span class="at">values_to =</span> <span class="st">"x"</span>, </span>
<span id="cb12-3"><a href="#cb12-3"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">separate</span>(x, <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>), <span class="at">sep =</span> <span class="st">"−"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="fu">select</span>(<span class="sc">-</span>g)</span>
<span id="cb12-6"><a href="#cb12-6"></a>df</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 129 × 2
      x1    x2
   &lt;int&gt; &lt;int&gt;
 1    18    25
 2    18    30
 3    17    30
 4    20    35
 5    15    28
 6    18    25
 7    18    35
 8    19    28
 9    17    30
10    16    30
# ℹ 119 more rows</code></pre>
</div>
</div>
<p>这样就得到了，每位专家认为的属于“青年人”的最小年龄和最大年龄。</p>
<p><strong>第二步</strong>，构建隶属函数</p>
<p>“青年人”的隶属函数，就是包含年龄 <code>x</code> 的年龄区间（最小年龄和最大年龄之间）的占比：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>mf <span class="ot">=</span> <span class="cf">function</span>(x) {</span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">summarise</span>(df, <span class="at">p =</span> <span class="fu">mean</span>(x1 <span class="sc">&lt;=</span> x <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> x2)) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="fu">pull</span>(p)</span>
<span id="cb14-4"><a href="#cb14-4"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>有一个或多个年龄，都能计算隶属度：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>ages <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="fl">16.5</span>, <span class="dv">20</span>, <span class="dv">43</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">map_dbl</span>(ages, mf)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9922481 0.3953488 1.0000000 0.0000000</code></pre>
</div>
</div>
<p>可视化该“青年人”隶属函数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">tibble</span>(年龄 <span class="ot">=</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">40</span>, 隶属度 <span class="ot">=</span> <span class="fu">map_dbl</span>(年龄, mf)) <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(年龄, 隶属度)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> 年龄, <span class="at">yend =</span> <span class="dv">0</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fuzzy-eval_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="主观专家经验法" class="level4" data-number="10.1.2.2"><h4 data-number="10.1.2.2" class="anchored" data-anchor-id="主观专家经验法">
<span class="header-section-number">10.1.2.2</span> 主观/专家经验法</h4>
<p>主观/专家经验法，是由领域专家根据经验或直观判断直接设定隶属函数的形式和参数，无需依赖数据统计或复杂计算。</p>
<p>比如，常用的三角隶属函数、梯形隶属函数、高斯隶属函数：</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figs/tri-mf.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>三角隶属函数</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figs/trap-mf.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>梯形隶属函数</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figs/gauss-mf.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>高斯隶属函数</figcaption></figure>
</div>
</div>
</div>
<p>隶属度函数的理解：以梯形隶属度函数为例，比如某指标值最优区间是 <span class="math inline">\([5,10]\)</span>，则落在该区间内的该指标值，我们认为都是“最优”的，但 <span class="math inline">\(4.7\)</span> 呢？我们不希望从 <span class="math inline">\(5\)</span> 直接就到不是”最优”，而是让它们有一个自然的过度，比如取 <span class="math inline">\([4,5]\)</span> 和 <span class="math inline">\([10,11]\)</span> 线性过度到不是”最优”，那么关于 <span class="math inline">\(4.7\)</span> 这个点，有 <span class="math inline">\(\dfrac{4.7-4}{5-4}=0.7\)</span>，即 <span class="math inline">\(4.7\)</span> 隶属于最优区间 <span class="math inline">\([5,10]\)</span> 的程度是 <span class="math inline">\(0.7\)</span>。</p>
<p>另外，还有双高斯隶属函数、广义贝尔隶属函数、Sigmoid 隶属函数族（单 Sigmoid、两 Sigmoid 之差、两 Sigmoid 之积）、多项式隶属函数族（分别形如<span class="math inline">\(Z,\bar{\pi},S\)</span>）。</p>
<p><code>mathmodels</code> 包提供了上述所有隶属函数的实现，以及可视化隶属函数的函数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">tri_mf</span>(x, params)</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="fu">trap_mf</span>(x, params)</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="fu">gauss_mf</span>(x, params)</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="fu">gbell_mf</span>(x, params)</span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="fu">gauss2mf</span>(x, params)</span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="fu">sigmoid_mf</span>(x, params)</span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="fu">dsigmoid_mf</span>(x, params)</span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="fu">psigmoid_mf</span>(x, params)</span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="fu">z_mf</span>(x, params)</span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="fu">pi_mf</span>(x, params)</span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="fu">s_mf</span>(x, params)</span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="fu">plot_mf</span>(mf, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">main =</span> <span class="cn">NULL</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>其中，<code>x</code> 为数值向量，<code>params</code> 为各隶属函数相应参数值向量，返回与 <code>x</code> 同样长度的隶属度值。</p>
<p>以梯形隶属函数为例，包含 <span class="math inline">\(4\)</span> 个参数，比如取 <code>1,5,7,8</code>，计算 <code>1:10</code> 的隶属度值：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>x <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">trap_mf</span>(x, <span class="at">params =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">8</span>))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.00 0.25 0.50 0.75 1.00 1.00 1.00 0.00 0.00 0.00</code></pre>
</div>
</div>
<p>可视化该梯形隶属函数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>f <span class="ot">=</span> \(x) <span class="fu">trap_mf</span>(x, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">8</span>))</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">plot_mf</span>(f, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">main =</span> <span class="st">"梯形隶属函数"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fuzzy-eval_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="compute_mf-函数" class="level3" data-number="10.1.3"><h3 data-number="10.1.3" class="anchored" data-anchor-id="compute_mf-函数">
<span class="header-section-number">10.1.3</span> <code>compute_mf()</code> 函数</h3>
<p>将单个指标值转化为属于各评语的隶属向量，是模糊综合评价计算隶属矩阵最核心的、大量重复使用的计算步。而非常常见且合理的做法，就是 三角+梯形隶属函数法 ，或叫做 分段线性隶属函数法。</p>
<p><code>mathmodels</code> 包提供了 <code>compute_mf()</code> 函数，实现基于三角隶属（两端是半梯形）将单个指标值转化为属于各评语的隶属向量，基本语法为：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">compute_mf</span>(x, thresholds)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<code>x</code> 为单个指标值；</li>
<li>
<code>thresholds</code> 为指标值划分到各评语的中间界限构成的向量（长度至少为 <span class="math inline">\(2\)</span>）</li>
<li>返回 <code>mv</code> 为隶属向量，对应单个评价对象的单个指标值。</li>
</ul>
<p><strong>用法示例</strong></p>
<p>举个例子，大气污染物评价，其中 SO2 的四个等级阈值为：</p>
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: center;">污染物</th>
<th style="text-align: center;">一级</th>
<th style="text-align: center;">二级</th>
<th style="text-align: center;">三级</th>
<th style="text-align: center;">四级</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: center;">SO2</td>
<td style="text-align: center;">0.05</td>
<td style="text-align: center;">0.15</td>
<td style="text-align: center;">0.25</td>
<td style="text-align: center;">0.50</td>
</tr></tbody>
</table>
<p>这表示：<span class="math inline">\(≤ 0.05\)</span> 是一级（<span class="math inline">\(100\%\)</span> 隶属），<span class="math inline">\(0.15\)</span> 是二级，<span class="math inline">\(0.25\)</span> 是三级，<span class="math inline">\(≥ 0.50\)</span> 是四级；中间区间线性从 <span class="math inline">\(1\)</span> 减到 <span class="math inline">\(0\)</span>，比如 <span class="math inline">\([0.05, 0.15]\)</span> 一级的隶属度是从 <span class="math inline">\(1\)</span> 线性降到 <span class="math inline">\(0\)</span>，二级隶属是从 <span class="math inline">\(0\)</span> 线性升到 <span class="math inline">\(1\)</span>，其他类似。</p>
<p>结合函数图形来理解更加直观。为了便于可视化演示，顺便提供了 <code>compute_mf_funs</code> 函数返回所有隶属函数，再用 <code>plot_mf</code> 函数做可视化：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>th <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.15</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a>mfs <span class="ot">=</span> <span class="fu">compute_mf_funs</span>(th)</span>
<span id="cb23-3"><a href="#cb23-3"></a>plots <span class="ot">=</span> <span class="fu">lapply</span>(mfs, \(x) <span class="fu">plot_mf</span>(x, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.6</span>))) </span>
<span id="cb23-4"><a href="#cb23-4"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(<span class="at">grobs =</span> plots, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="fuzzy-eval_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>分别是一级、二级、三级、四级的隶属函数，形状依次为右半梯形、三角形、三角形、左半梯形。以右上“二级”隶属函数为例，0.15 处为 1，区间 [0.05, 0.15] 上线性增长到 1。</p>
<p>比如，某天的 SO2 含量为 0.07，转化为隶属向量：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">compute_mf</span>(<span class="fl">0.07</span>, th)        <span class="co"># 计算隶属向量</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8 0.2 0.0 0.0</code></pre>
</div>
</div>
<p>这 4 个值，就是将 0.07 分别代入上述 4 个隶属函数得到的函数值构成。这表明，0.07 隶属于“一级”的程度是 0.8，隶属于“二级”的程度是 0.2，隶属于后两级的程度都是 0。</p>
</section><section id="模糊运算" class="level3" data-number="10.1.4"><h3 data-number="10.1.4" class="anchored" data-anchor-id="模糊运算">
<span class="header-section-number">10.1.4</span> 模糊运算</h3>
<section id="模糊逻辑运算" class="level4" data-number="10.1.4.1"><h4 data-number="10.1.4.1" class="anchored" data-anchor-id="模糊逻辑运算">
<span class="header-section-number">10.1.4.1</span> 模糊逻辑运算</h4>
<p>经典集特征函数值只取 <span class="math inline">\(0\)</span> 和 <span class="math inline">\(1\)</span>，标准布尔逻辑运算：<code>与</code>、<code>或</code>、<code>非</code></p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figs/bool-op.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>布尔运算示意图</figcaption></figure>
</div>
</div>
</div>
<p>换个写法：<code>与</code> 就是取 <span class="math inline">\(\min\)</span>，<code>或</code> 就是取 <span class="math inline">\(\max\)</span>，<code>非</code>就是做 <span class="math inline">\(1-x\)</span></p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figs/bool-op2.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>布尔运算换个写法</figcaption></figure>
</div>
</div>
</div>
<p>从经典集的布尔运算到模糊集的模糊运算，模糊集的隶属函数取值是 <span class="math inline">\([0,1]\)</span>。</p>
<p>模糊集与隶属函数（曲线）一一对应，所以，很自然地，模糊集的逻辑运算，就等同于隶属函数（曲线）的逻辑运算（取 <span class="math inline">\(\min\)</span>、取 <span class="math inline">\(\max\)</span>、做 <span class="math inline">\(1-x\)</span>）。</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="figs/fuzzy-op.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>从布尔运算到模糊运算</figcaption></figure>
</div>
</div>
</div>
</section><section id="模糊合成" class="level4" data-number="10.1.4.2"><h4 data-number="10.1.4.2" class="anchored" data-anchor-id="模糊合成">
<span class="header-section-number">10.1.4.2</span> 模糊合成</h4>
<p>设 <span class="math inline">\(R=(r_{ij})_{m\times n}\)</span> 为矩阵，若满足 <span class="math inline">\(0\leq r_{ij}\leq 1\)</span>，称为<strong>模糊矩阵</strong>，若 <span class="math inline">\(r_{ij}\)</span> 只取 <span class="math inline">\(0\)</span>或 <span class="math inline">\(1\)</span> 时，称为<strong>布尔矩阵</strong>。</p>
<p>模糊综合评价涉及模糊变换，即将模糊评价矩阵作用到向量，得到新向量： <span class="math display">\[
B_{m\times1}=R_{m\times n}\circ A_{n\times1}
\]</span> 其中，<span class="math inline">\(\circ\)</span> 为模糊合成算子，记 <span class="math inline">\(A=[a_1,\cdots,a_m]^T, \, B=[b_1,\cdots,b_m]^T\)</span>。</p>
<p>模糊变换根据目的不同，可以选择不同的模糊合成算子：</p>
<section id="取小取大主因素决定型" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="取小取大主因素决定型">(1) 取小取大，主因素决定型</h5>
<p><span class="math display">\[
b_j = \max_i\big\{\min \{a_i,r_{ij}\}\big\},\quad j=1,\cdots,m
\]</span> 通常用的算子，其评判结果只取决于在总评价中起主要作用的那个因素，其余因素均不影响评判结果，比较适用于单项评判最优就能作为综合评判最优的情况。</p>
</section><section id="乘积最大主因素突出型" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="乘积最大主因素突出型">(2) 乘积最大，主因素突出型</h5>
<p><span class="math display">\[
b_j=\max_i \{a_i\cdot r_{ij} \},\quad j=1,\cdots,m
\]</span></p>
<p>与取小取大相近，但更精细些，不仅突出了主要因素，也兼顾了其他因素。此模型适用于模型失效（不可区别），需要“加细”的情况。</p>
</section><section id="乘加加权平均型" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="乘加加权平均型">(3) 乘加，加权平均型</h5>
<p><span class="math display">\[
b_j=\sum_{i=1}^n a_i \cdot r_{ij}, \quad j=1,\cdots,m
\]</span> 该算子依权重的大小对所有因素均衡兼顾，比较适用于求总和最大的情形。</p>
</section><section id="取小上界和型" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="取小上界和型">(4) 取小上界和型</h5>
<p><span class="math display">\[
b_j = \min\Big\{1,\sum_{i=1}^n \min \{a_i,r_{ij} \}\Big\}, \quad j=1,\cdots,m
\]</span> 在使用此算子时，需要注意：各个 <span class="math inline">\(a_i\)</span> 不能取得偏大，否则可能出现 <span class="math inline">\(b_j\)</span> 均等于 <span class="math inline">\(1\)</span> 的情形；各个 <span class="math inline">\(a_i\)</span> 也不能取得太小，否则可能出现 <span class="math inline">\(b_j\)</span> 均等于各个 <span class="math inline">\(a_i\)</span> 之和的情形，这将使单因素评判的有关信息丢失。</p>
</section><section id="均衡平均型" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="均衡平均型">(5) 均衡平均型</h5>
<p><span class="math display">\[
b_j = \sum_{i=1}^n \Big(a_i \wedge \frac{r_{ij}}{r_0}\Big), \quad j=1,\cdots,m
\]</span> <span class="math inline">\(r_{0}=\sum\limits_{k=1}^{m}r_{kj}\)</span>，该算子实际上先对模糊评价矩阵 <span class="math inline">\(R\)</span> 中的列向量做了归一化处理, 适用于 <span class="math inline">\(R\)</span> 中元素偏大或偏小的情形。</p>
<p><code>mathmodels</code> 包提供了 <code>fuzzy_eval()</code> 函数实现模糊合成，基本语法为：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">fuzzy_eval</span>(w, R, type)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<code>w</code> 为各因素的权重向量，<code>R</code> 为模糊评价矩阵，<code>type</code> 可选上述 <span class="math inline">\(5\)</span> 种模糊合成算子：<span class="math inline">\(1 \sim 5\)</span>。</li>
</ul></section></section></section></section><section id="模糊综合评价算法步骤" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="模糊综合评价算法步骤">
<span class="header-section-number">10.2</span> 模糊综合评价算法步骤</h2>
<section id="确定因素集及权重向量" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="确定因素集及权重向量">(1) 确定因素集及权重向量</h5>
<p>设某评价对象的评价因素有 <span class="math inline">\(n\)</span> 个，记作 <span class="math inline">\(U=\{u_1,\cdots,u_n\}\)</span>，称为因素集。由于各种因素所处地位和作用的不 同，考虑用权重向量来衡量，实际中该权重向量可以借助主客观赋权法来得到。</p>
<p>例如，某人要购买一件衣服，她要考虑 4 个因素： <span class="math display">\[
u_1=\text{色彩},\quad u_2 =\text{做工}, \quad u_3=\text{品牌},\quad u_4=\text{款式}
\]</span></p>
<p>4 个因素在评价过程中的权重向量为 <span class="math inline">\(w = [0.3,0.3,0.3,0.1]^T\)</span>。</p>
</section><section id="确定评语集" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="确定评语集">(2) 确定评语集</h5>
<p>设所有可能的评语有 <span class="math inline">\(m\)</span> 个，记为 <span class="math inline">\(V=\{v_1,⋯,v_m\}\)</span>，称为评语集。</p>
<p>例如，对衣服的评语集为 <span class="math display">\[
v_1=\text{好}, \quad v_2=\text{一般}, \quad v_3=\text{差}
\]</span></p>
</section><section id="建立模糊评价矩阵" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="建立模糊评价矩阵">(3) 建立模糊评价矩阵</h5>
<p>先对该事物的每个因素隶属于各个评语的程度进行评价（评委打分或经验隶属函数）。</p>
<p>例如，某件衣服，对于”色彩”，<span class="math inline">\(80\%\)</span> 的评委认为是“好”，<span class="math inline">\(10\%\)</span> 的评委认为是”一般”，<span class="math inline">\(10\%\)</span> 的评委认为是”差”。</p>
<p>则该件衣服因素 1：“色彩”隶属于评语集每个评语：“好”、“一般”、“差”的隶属度为：<span class="math inline">\(r_1=[0.8,0.1,0.1]^T\)</span>；</p>
<p>同样，因素 2：“做工”隶属于每个评语：“好”、“一般”、“差”的隶属度为：<span class="math inline">\(r_2=[0.7,0.2,0.1]^T\)</span>；</p>
<p>因素 3：“品牌” 隶属于每个评语：“好”、“一般”、“差”的隶属度为：<span class="math inline">\(r_3=[0.6,0.2,0.2]^T\)</span>；</p>
<p>因素 4：“款式” 隶属于每个评语：“好”、“一般”、“差”的隶属度为：<span class="math inline">\(r_{4}=[0.7,0.1,0.2]^{T}\)</span>。</p>
<p>于是，得到模糊评价矩阵： <span class="math display">\[
R = [r_1,r_2,r_3,r_4] =
\begin{bmatrix}
0.8&amp;0.7&amp;0.6&amp;0.7\\
0.1&amp;0.2&amp;0.2&amp;0.1\\
0.1&amp;0.1&amp;0.2&amp;0.2
\end{bmatrix}
\]</span></p>
</section><section id="做模糊综合合成" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="做模糊综合合成">(4) 做模糊综合合成</h5>
<p>基于合适的模糊合成算子，比如选 <code>3</code> 加权平均型，做模糊合成得到模糊评价向量：<span class="math inline">\(\mu=R\circ w\)</span>，一般对 <span class="math inline">\(\mu\)</span> 进 行归一化处理。</p>
<p>这里的 <span class="math inline">\(R\)</span> 是分别的、单独的评价（隶属程度），再综合各因素占的权重 <span class="math inline">\(w\)</span>，所以叫做模糊综合评价。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>w <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>)</span>
<span id="cb27-2"><a href="#cb27-2"></a>R <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>,</span>
<span id="cb27-3"><a href="#cb27-3"></a>             <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>,</span>
<span id="cb27-4"><a href="#cb27-4"></a>             <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-5"><a href="#cb27-5"></a>mu <span class="ot">=</span> <span class="fu">fuzzy_eval</span>(w, R, <span class="dv">3</span>)</span>
<span id="cb27-6"><a href="#cb27-6"></a>mu</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.70 0.16 0.14</code></pre>
</div>
</div>
</section><section id="去模糊化得到最终评价" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="去模糊化得到最终评价">(5) 去模糊化得到最终评价</h5>
<p>模糊评价向量 <span class="math inline">\(\mu\)</span> 是这件衣服对各评语：“好”、“一般”、“差”的隶属度，要得到最终评语或评分，还需要做一步去模糊化。</p>
<p><code>mathmodels</code> 包，提供了 <code>defuzzify()</code> 函数，实现对模糊评价向量去模糊化，基本语法为：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">defuzzify</span>(mu, scores, <span class="at">method =</span> <span class="st">"weighted_average"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<code>mu</code> 为模糊评价向量；</li>
<li>
<code>scores</code> 为各评语的量化分数；</li>
<li>
<code>method</code> 选择去模糊化方法，可选 <code>"max_membership"</code>：最大隶属度法（隶属度最大值对应评语的量化分数）、<code>"weighted_average"</code>：加权平均法（默认，隶属度值与各评语量化分数做加权求和）、<code>"centroid"</code>：重心法。</li>
</ul>
<p><strong>注：</strong>对于归一化的模糊评价隶属向量，加权平均法与重心法结果是相同的。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>scores <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">75</span>, <span class="dv">50</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="fu">defuzzify</span>(mu, scores, <span class="at">method =</span> <span class="st">"max_membership"</span>)       <span class="co"># 最大隶属度法</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 90</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">defuzzify</span>(mu, scores)                                  <span class="co"># 加权平均法</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 82</code></pre>
</div>
</div>
</section></section><section id="案例耕作方案的模糊综合评价" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="案例耕作方案的模糊综合评价">
<span class="header-section-number">10.3</span> 案例：耕作方案的模糊综合评价</h2>
<p>某平原产粮区进行耕作制度改革，制定了甲（三种三收）、乙（两茬平作）、丙（两年三熟）3 种方案。主要评价指标选取 5 项：粮食亩产量、农产品质量、每亩用工量、每亩纯收入、生态环境影响。根据当地实际情况，这 5 个因素的权重分别为 <span class="math inline">\(0.2, 0.1, 0.15, 0.3, 0.25\)</span>，其评价等级如表 1 所示：</p>
<table class="caption-top table">
<caption>耕作方案评价指标数据的等级划分</caption>
<colgroup>
<col style="width: 7%">
<col style="width: 20%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 20%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">分数</th>
<th style="text-align: center;">亩产量/kg</th>
<th style="text-align: center;">产品质量/级</th>
<th style="text-align: center;">亩用工量/工日</th>
<th style="text-align: center;">亩纯收入/元</th>
<th style="text-align: center;">生态环境影响/级</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">优</td>
<td style="text-align: center;">550 以上</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">20 以下</td>
<td style="text-align: center;">130 以上</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">良</td>
<td style="text-align: center;">450-550</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">20-40</td>
<td style="text-align: center;">90-130</td>
<td style="text-align: center;">2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">中</td>
<td style="text-align: center;">350-450</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">40-60</td>
<td style="text-align: center;">50-90</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="even">
<td style="text-align: center;">差</td>
<td style="text-align: center;">350 以下</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">60 以上</td>
<td style="text-align: center;">50 以下</td>
<td style="text-align: center;">4</td>
</tr>
</tbody>
</table>
<p>经过调查并应用各种参数进行计算预测，发现 3 种方案的 5 项指标可达到表 2 中的数值：</p>
<table class="caption-top table">
<caption>三种耕作方案的指标数据</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 20%">
<col style="width: 17%">
<col style="width: 22%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">方案</th>
<th style="text-align: center;">亩产量/kg</th>
<th style="text-align: center;">产品质量/级</th>
<th style="text-align: center;">亩用工量/工日</th>
<th style="text-align: center;">亩纯收入/元</th>
<th style="text-align: center;">生态环境影响/级</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">甲</td>
<td style="text-align: center;">592.5</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">55</td>
<td style="text-align: center;">72</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: center;">乙</td>
<td style="text-align: center;">529</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">38</td>
<td style="text-align: center;">105</td>
<td style="text-align: center;">3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">丙</td>
<td style="text-align: center;">412</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">85</td>
<td style="text-align: center;">2</td>
</tr>
</tbody>
</table>
<p>问究竟应该选择哪种方案？</p>
<p><strong>模糊综合评价，超级简洁、可以随便替换成自己数据的通用流程</strong>如下：</p>
<ul>
<li>
<code>compute_mf</code> 函数是根据指标阈值和单个指标值，计算<strong>隶属向量</strong>；</li>
<li>批量调用<code>compute_mf</code> 函数，对一个评价对象（耕作方案）的所有指标值和相应指标阈值，都算一遍再合并，就计算出<strong>隶属矩阵</strong>；</li>
<li>隶属矩阵和指标权重向量做模糊综合合成（<code>fuzzy_eval</code> 函数），就得到模糊综合评价结果向量，再去模糊化（<code>defuzzify</code> 函数）到最终评价分数；</li>
<li>再对每个评价对象重复上述过程。</li>
</ul>
<p>下面具体求解。</p>
<section id="准备评价对象数据表2" class="level3" data-number="10.3.1"><h3 data-number="10.3.1" class="anchored" data-anchor-id="准备评价对象数据表2">
<span class="header-section-number">10.3.1</span> 准备评价对象数据（表2）</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>df <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">product =</span> <span class="fu">c</span>(<span class="fl">592.5</span>, <span class="dv">529</span>, <span class="dv">412</span>), <span class="at">quality =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">1</span>, </span>
<span id="cb34-2"><a href="#cb34-2"></a>            <span class="at">labor =</span> <span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">38</span>, <span class="dv">32</span>), </span>
<span id="cb34-3"><a href="#cb34-3"></a>            <span class="at">income =</span> <span class="fu">c</span>(<span class="dv">72</span>, <span class="dv">105</span>, <span class="dv">85</span>), <span class="at">ecology =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb34-4"><a href="#cb34-4"></a>df</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  product quality labor income ecology
    &lt;dbl&gt;   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;int&gt;
1    592.       3    55     72       4
2    529        2    38    105       3
3    412        1    32     85       2</code></pre>
</div>
</div>
<p><strong>数据预处理</strong></p>
<p>注意，产品质量、亩用工量、生态环境影响是负向指标，需要转化为正向。应该从固定不变的阈值考虑（而不是可变的具体方案指标值），采用最大值 + 平移值做差 方式。 比如，1、2、3、4 要变成 4、3、2、1，需要的变换是 <span class="math inline">\(5 - x\)</span>；而 20、40、60 要变成 60、40、20，需要的变换是 <span class="math inline">\(80 - x\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>df <span class="ot">=</span> df <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), \(x) <span class="dv">5</span> <span class="sc">-</span> x), <span class="at">labor =</span> <span class="dv">80</span> <span class="sc">-</span> labor)</span>
<span id="cb36-3"><a href="#cb36-3"></a>df</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  product quality labor income ecology
    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1    592.       2    25     72       1
2    529        3    42    105       2
3    412        4    48     85       3</code></pre>
</div>
</div>
</section><section id="准备阈值数据从表1提炼用于计算隶属向量" class="level3" data-number="10.3.2"><h3 data-number="10.3.2" class="anchored" data-anchor-id="准备阈值数据从表1提炼用于计算隶属向量">
<span class="header-section-number">10.3.2</span> 准备阈值数据（从表1提炼，用于计算隶属向量）</h3>
<p>评语集是分数列，对应到优良中差：3（优）、2（良）、1（中）、0（差）。 注意，共有 4 个评语，需要 4 个阈值（同示例）。产品质量和生态环境是 <span class="math inline">\(1, 2, 3, 4\)</span>（可以直接用），其他三个，比如亩产量只提供了 3 个阈值：<span class="math inline">\(350, 450, 550\)</span>，显然在前面补一个 <span class="math inline">\(0\)</span> 是合理的。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>th_mat <span class="ot">=</span> <span class="fu">tibble</span>(</span>
<span id="cb38-2"><a href="#cb38-2"></a>  <span class="at">th1 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">350</span>, <span class="dv">450</span>, <span class="dv">550</span>),            <span class="co"># 亩产量 </span></span>
<span id="cb38-3"><a href="#cb38-3"></a>  <span class="at">th2 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,                            <span class="co"># 产品质量</span></span>
<span id="cb38-4"><a href="#cb38-4"></a>  <span class="at">th3 =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">60</span>,<span class="dv">20</span>),                   <span class="co"># 亩用工量</span></span>
<span id="cb38-5"><a href="#cb38-5"></a>  <span class="at">th4 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">90</span>, <span class="dv">130</span>),              <span class="co"># 亩收入</span></span>
<span id="cb38-6"><a href="#cb38-6"></a>  <span class="at">th5 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)                            <span class="co"># 生态环境影响</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="批量模糊综合评价" class="level3" data-number="10.3.3"><h3 data-number="10.3.3" class="anchored" data-anchor-id="批量模糊综合评价">
<span class="header-section-number">10.3.3</span> 批量模糊综合评价</h3>
<p>本例只有 3 个评价对象，当然可以一个一个地分别计算。</p>
<p>为了通用于任意多个评价对象，把<strong>对一个评价对象做模糊综合评价</strong>的写成函数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>eval_one <span class="ot">=</span> <span class="cf">function</span>(x, <span class="at">type =</span> <span class="dv">3</span>, <span class="at">method =</span> <span class="st">"max_membership"</span>) {</span>
<span id="cb39-2"><a href="#cb39-2"></a>  <span class="co"># x为一个评价对象(提取df的某一行, 转化为向量)</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>  R <span class="ot">=</span> <span class="fu">map2_dfc</span>(x, th_mat, compute_mf) </span>
<span id="cb39-4"><a href="#cb39-4"></a>  mu <span class="ot">=</span> <span class="fu">fuzzy_eval</span>(w, R, type)               <span class="co"># 默认对结果归一化</span></span>
<span id="cb39-5"><a href="#cb39-5"></a>  s <span class="ot">=</span> <span class="fu">defuzzify</span>(mu, scores, method)</span>
<span id="cb39-6"><a href="#cb39-6"></a>  <span class="fu">list</span>(<span class="at">s =</span> s, <span class="at">mu =</span> mu, <span class="at">R =</span> R)</span>
<span id="cb39-7"><a href="#cb39-7"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>其中，<code>type</code> 选择模糊合成的方法，可选 1：取小取大（主因素决定）、2： 乘积最大（主因素突出）、3：乘加（加权平均）、4： 取小上界和、5： 均衡平均。 <code>method</code> 选择去模糊化方法，可选 <code>"max_membership"</code>：最大隶属度法、<code>"weighted_average"</code>：加权平均法、<code>"centroid"</code>：重心法。</p>
<p><strong>注：</strong>对于归一化的模糊评价隶属向量，加权平均法与重心法结果是相同的。</p>
<p>准备共用数据：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>w <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.3</span>, <span class="fl">0.25</span>)  <span class="co"># 各指标权重, 可另由赋权法计算</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>scores <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">75</span>, <span class="dv">90</span>)        <span class="co"># 优良中差的量化分数，用于去模糊化</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>方法 1</strong>：按默认的 乘加法 模糊合成，按最大隶属度法去模糊化。</p>
<p>在 <code>df</code> 上逐行迭代即可：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>res_m <span class="ot">=</span> <span class="fu">apply</span>(df, <span class="dv">1</span>, eval_one)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>查看 3 种方案的模糊综合评价结果向量：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">map</span>(res_m, <span class="st">"mu"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.2500 0.3475 0.2025 0.2000

[[2]]
[1] 0.0000 0.2500 0.4645 0.2855

[[3]]
[1] 0.0000 0.1135 0.7265 0.1600</code></pre>
</div>
</div>
<p>查看 3 种方案的最终得分（上述模糊向量去模糊化），最大隶属度法即最大值所属评语的量化分数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="fu">map_dbl</span>(res_m, <span class="st">"s"</span>)  </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60 75 75</code></pre>
</div>
</div>
<ul>
<li>查看 3 种方案的隶属矩阵，由隶属向量构成：</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="fu">map</span>(res_m, <span class="st">"R"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 4 × 5
  product quality labor income ecology
    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1       0       0  0      0          1
2       0       1  0.75   0.45       0
3       0       0  0.25   0.55       0
4       1       0  0      0          0

[[2]]
# A tibble: 4 × 5
  product quality labor income ecology
    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1    0          0   0    0           0
2    0          0   0    0           1
3    0.21       1   0.9  0.625       0
4    0.79       0   0.1  0.375       0

[[3]]
# A tibble: 4 × 5
  product quality labor income ecology
    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1    0          0   0    0           0
2    0.38       0   0    0.125       0
3    0.62       0   0.6  0.875       1
4    0          1   0.4  0           0</code></pre>
</div>
</div>
<p><strong>方法 2</strong>：按默认的<strong>乘加法</strong>模糊合成，按加权平均法去模糊化。</p>
<p>对 <code>df</code> 逐行迭代，只查看 3 种方案的最终评分：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>res_w <span class="ot">=</span> <span class="fu">apply</span>(df, <span class="dv">1</span>, \(x) <span class="fu">eval_one</span>(x, <span class="at">method =</span> <span class="st">"centroid"</span>))</span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="fu">map_dbl</span>(res_w, <span class="st">"s"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 61.5375 75.5325 75.6975</code></pre>
</div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "已复制");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "已复制");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./rank-sum-ratio.html" class="pagination-link" aria-label="秩和比法">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">秩和比法</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./dea.html" class="pagination-link" aria-label="数据包络分析">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">数据包络分析</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>